<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Text Research Center | Science Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        research: { 
                            50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 
                            500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 
                            800: '#5b21b6', 900: '#4c1d95' 
                        },
                        glass: {
                            100: 'rgba(255, 255, 255, 0.1)',
                            200: 'rgba(255, 255, 255, 0.2)',
                            700: 'rgba(255, 255, 255, 0.7)',
                            900: 'rgba(255, 255, 255, 0.9)',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        "fade-in": "fadeIn 0.5s ease-out forwards",
                        "float": "float 6s ease-in-out infinite",
                    },
                    keyframes: {
                        "fadeIn": { "0%": { opacity: "0", transform: "translateY(10px)" }, "100%": { opacity: "1", transform: "translateY(0)" } },
                        "float": { "0%, 100%": { transform: "translateY(0)" }, "50%": { transform: "translateY(-10px)" } }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(109, 40, 217, 0.08);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-8px);
            box-shadow: 0 15px 40px -10px rgba(124, 58, 237, 0.25);
            border-color: rgba(124, 58, 237, 0.3);
        }
        .title-3d {
            background: linear-gradient(135deg, #4c1d95 0%, #6d28d9 50%, #8b5cf6 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(2px 2px 0px rgba(139, 92, 246, 0.3));
        }
        .text-editor {
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.6;
            background-color: #f8fafc;
            transition: all 0.2s;
        }
        .text-editor:focus {
            background-color: white;
            box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.2);
            border-color: #7c3aed;
            outline: none;
        }
        .loader {
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-radius: 50%;
            border-top: 3px solid #7c3aed;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10;
            overflow: hidden;
            background: linear-gradient(135deg, #f5f3ff 0%, #eef2ff 100%);
            background-size: 400% 400%;
        }
        .checkbox-wrapper label { cursor: pointer; display: flex; align-items: center; font-size: 0.875rem; color: #475569; margin-bottom: 0.5rem; }
        .checkbox-wrapper input { margin-right: 0.5rem; accent-color: #7c3aed; width: 1rem; height: 1rem; }
        .hidden-section { display: none !important; }
    </style>
</head>
<body class="min-h-screen font-sans flex flex-col text-slate-800 relative overflow-hidden selection:bg-research-200 selection:text-research-900">

    <!-- 背景動態 -->
    <div id="canvas-container"><canvas id="network-canvas"></canvas></div>

    <!-- 頂部導航列 -->
    <nav class="glass-panel sticky top-0 z-50 border-b-0">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="backToDashboard()">
                <div class="bg-research-100/80 p-2 rounded-xl text-research-700 shadow-inner">
                    <i class="fa-solid fa-microscope text-xl"></i>
                </div>
                <span class="text-xl font-bold tracking-tight text-slate-800 hidden md:block">Researcher Hub</span>
            </div>
            
            <div class="flex items-center space-x-4">
                <select id="language-selector" onchange="changeLanguage()" class="glass-card rounded-xl py-2 px-4 text-sm font-medium outline-none focus:ring-2 focus:ring-research-500 cursor-pointer text-slate-700">
                    <option value="zh-TW">繁體中文</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                    <option value="zh-CN">简体中文</option>
                </select>
                
                <div class="flex items-center gap-3 pl-4 border-l border-slate-300/50">
                    <div class="flex items-center gap-2">
                        <div class="w-9 h-9 rounded-full bg-gradient-to-br from-research-100 to-research-50 text-research-600 flex items-center justify-center text-sm font-bold border border-research-200 shadow-sm" id="user-avatar">R</div>
                        <span class="text-sm font-bold text-slate-700 hidden md:block" id="user-name-display">Researcher</span>
                    </div>
                    <button onclick="logout()" class="text-slate-400 hover:text-rose-500 transition p-2 rounded-full hover:bg-rose-50" title="登出">
                        <i class="fa-solid fa-right-from-bracket text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主內容區 -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 relative z-10 h-[calc(100vh-80px)]">
        <div class="max-w-7xl mx-auto h-full flex flex-col">
            
            <!-- 1. 儀表板視圖 (Dashboard View) -->
            <div id="dashboard-view" class="fade-in flex-1 flex flex-col">
                <div class="text-center mb-12 mt-6">
                    <span class="text-research-600 font-bold tracking-wider text-base uppercase mb-3 block opacity-80" data-i18n="role_researcher">研究專區</span>
                    <!-- 修改：標題改為「科學文本研究中心」 -->
                    <h1 class="title-3d text-5xl md:text-7xl font-black mb-6 tracking-tight" data-i18n="welcome_researcher">科學文本研究中心</h1>
                    <p class="text-slate-500 text-xl md:text-2xl max-w-3xl mx-auto font-medium" data-i18n="select_tool">請選擇高階文本分析工具</p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 px-4 mb-12">
                    <!-- 卡片 1: 科學文本斷詞 -->
                    <div onclick="window.location.href='text_segmentation.html'" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                        <i class="fa-solid fa-scissors text-4xl text-purple-500 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-700 group-hover:text-purple-600 transition mb-2" data-i18n="feat_r_1">科學文本斷詞</h4>
                        <p class="text-xs text-slate-500">CKIP/Jieba 斷詞工具</p>
                    </div>

                    <!-- 卡片 2: 科學文本查詢 -->
                    <div onclick="window.location.href='science_text_query.html'" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                        <i class="fa-solid fa-magnifying-glass text-4xl text-purple-500 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-700 group-hover:text-purple-600 transition mb-2" data-i18n="feat_r_2">科學文本查詢</h4>
                        <p class="text-xs text-slate-500">資料庫檢索系統</p>
                    </div>

                    <!-- 卡片 3: 文本詞彙比較 -->
                    <div onclick="window.location.href='textvocabularycomparison.html'" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                        <i class="fa-solid fa-scale-balanced text-4xl text-purple-500 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-700 group-hover:text-purple-600 transition mb-2" data-i18n="feat_r_3">文本詞彙比較</h4>
                        <p class="text-xs text-slate-500">跨文本詞彙分析</p>
                    </div>

                    <!-- 卡片 4: 文本可讀性分析 -->
                    <div onclick="window.location.href='text_readability.html'" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                        <i class="fa-solid fa-book-open-reader text-4xl text-purple-500 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-700 group-hover:text-purple-600 transition mb-2" data-i18n="feat_r_4">文本可讀性分析</h4>
                        <p class="text-xs text-slate-500">難易度指標檢測</p>
                    </div>

                    <!-- 卡片 5: 概念網絡分析 -->
                    <div onclick="window.location.href='concept_network.html'" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                        <i class="fa-solid fa-circle-nodes text-4xl text-purple-500 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-700 group-hover:text-purple-600 transition mb-2" data-i18n="feat_r_5">概念網絡分析</h4>
                        <p class="text-xs text-slate-500">知識圖譜視覺化</p>
                    </div>

                    <!-- 卡片 6: 系統功能語言分析 (預留/未指定) -->
                    <div onclick="alert('此功能開發中')" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center opacity-70">
                        <i class="fa-solid fa-spell-check text-4xl text-purple-500 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-700 group-hover:text-purple-600 transition mb-2" data-i18n="feat_r_6">系統功能語言分析</h4>
                        <p class="text-xs text-slate-500">SFL Analysis</p>
                    </div>

                    <!-- 卡片 7: 文本文字雲系統 -->
                    <div onclick="window.location.href='word_cloud.html'" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                        <i class="fa-solid fa-cloud text-4xl text-purple-500 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-700 group-hover:text-purple-600 transition mb-2" data-i18n="feat_r_7">文本文字雲系統</h4>
                        <p class="text-xs text-slate-500">關鍵詞權重視覺化</p>
                    </div>

                    <!-- 卡片 8: 文本相似性分析 (內建) -->
                    <div onclick="openTool('similarity')" class="glass-card p-6 rounded-3xl cursor-pointer group relative overflow-hidden flex flex-col items-center text-center border-2 border-research-200 bg-research-50/50">
                        <i class="fa-solid fa-layer-group text-4xl text-purple-600 mb-4 group-hover:scale-110 transition"></i>
                        <h4 class="font-bold text-slate-800 group-hover:text-purple-700 transition mb-2" data-i18n="feat_r_8">文本相似性分析</h4>
                        <p class="text-xs text-slate-600 font-bold">結構・語意・概念比對</p>
                    </div>
                </div>
            </div>

            <!-- 2. 工具視窗容器 (僅保留相似性分析) -->
            <div id="tool-container" class="hidden-section fade-in flex flex-col h-full">
                <button onclick="backToDashboard()" class="mb-4 flex items-center gap-2 text-slate-500 hover:text-research-600 transition font-bold bg-white/50 px-4 py-2 rounded-full w-fit backdrop-blur-sm hover:bg-white">
                    <i class="fa-solid fa-arrow-left"></i> <span data-i18n="back_dashboard">返回研究中心</span>
                </button>

                <!-- 工具內容區：文本相似度分析實驗室 -->
                <div id="tool-similarity" class="glass-panel rounded-3xl flex-1 flex overflow-hidden relative">
                    
                    <!-- 左側：控制面板 -->
                    <aside class="w-1/4 min-w-[280px] border-r border-slate-200 flex flex-col overflow-y-auto p-5 bg-white/80">
                        <div class="mb-6">
                            <h2 class="text-sm font-bold text-slate-900 mb-4 flex items-center">
                                <i class="fa-solid fa-sliders mr-2 text-research-600"></i> <span data-i18n="panel_config">分析模型設定</span>
                            </h2>
                            
                            <!-- 結構層 -->
                            <div class="mb-4 p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <h3 class="text-xs font-bold text-slate-500 uppercase mb-3 tracking-wider" data-i18n="dim_structure">結構層 (Structure)</h3>
                                <div class="checkbox-wrapper flex flex-col gap-2">
                                    <label><input type="checkbox" id="use-jaccard" checked> Jaccard Similarity</label>
                                    <label><input type="checkbox" id="use-cosine" checked> Cosine Similarity</label>
                                    <label><input type="checkbox" id="use-edit"> Edit Distance</label>
                                </div>
                            </div>

                            <!-- 概念層 -->
                            <div class="mb-4 p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <h3 class="text-xs font-bold text-slate-500 uppercase mb-3 tracking-wider" data-i18n="dim_concept">概念層 (Concept)</h3>
                                <div class="checkbox-wrapper flex flex-col gap-2">
                                    <label><input type="checkbox" id="use-curriculum" checked> Curriculum Coverage</label>
                                    <label><input type="checkbox" id="use-concept-overlap" checked> Concept Overlap</label>
                                </div>
                            </div>

                            <!-- 語意層 -->
                            <div class="mb-4 p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <h3 class="text-xs font-bold text-slate-500 uppercase mb-3 tracking-wider" data-i18n="dim_semantic">語意層 (Semantic)</h3>
                                <div class="checkbox-wrapper flex flex-col gap-2">
                                    <label><input type="checkbox" id="use-embedding" checked> AI Embedding</label>
                                    <label><input type="checkbox" id="use-llm-insight" checked> LLM Insight</label>
                                </div>
                            </div>
                        </div>

                        <button onclick="runAnalysis()" class="mt-auto w-full bg-research-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-research-200 hover:bg-research-700 transition transform active:scale-[0.98] flex items-center justify-center gap-2">
                            <i class="fa-solid fa-microscope"></i> <span data-i18n="btn_analyze">執行分析</span>
                        </button>
                    </aside>

                    <!-- 右側：主工作區 -->
                    <div class="w-3/4 flex flex-col bg-slate-50/50">
                        <!-- 上半部：輸入 -->
                        <div class="h-1/2 flex flex-col border-b border-slate-200">
                            <div class="px-6 py-2 flex justify-between items-center bg-white/60 backdrop-blur border-b border-slate-100">
                                <span class="text-xs font-bold text-slate-500 uppercase tracking-wider" data-i18n="section_input">文本輸入</span>
                                <div class="flex gap-2">
                                    <button onclick="loadExample()" class="text-xs bg-research-50 text-research-600 px-3 py-1.5 rounded hover:bg-research-100 transition font-medium border border-research-200 flex items-center gap-1">
                                        <i class="fa-solid fa-flask"></i> <span data-i18n="btn_example">載入範例</span>
                                    </button>
                                    <button onclick="clearText()" class="text-xs text-slate-400 hover:text-red-500 px-2 py-1.5 transition flex items-center gap-1">
                                        <i class="fa-solid fa-trash-can"></i> <span data-i18n="btn_clear">清空</span>
                                    </button>
                                </div>
                            </div>
                            <div class="flex-1 flex overflow-hidden">
                                <div class="flex-1 flex flex-col border-r border-slate-200 relative">
                                    <textarea id="text-a" class="text-editor w-full h-full p-5 resize-none text-sm focus:bg-white" placeholder="文本 A (例如：教科書定義、標準答案...)" onscroll="syncScroll('text-a', 'text-b')"></textarea>
                                    <div class="absolute bottom-2 right-4 text-xs text-slate-300 font-mono font-bold">Text A</div>
                                </div>
                                <div class="flex-1 flex flex-col relative">
                                    <textarea id="text-b" class="text-editor w-full h-full p-5 resize-none text-sm focus:bg-white" placeholder="文本 B (例如：學生回答、比較文本...)" onscroll="syncScroll('text-b', 'text-a')"></textarea>
                                    <div class="absolute bottom-2 right-4 text-xs text-slate-300 font-mono font-bold">Text B</div>
                                </div>
                            </div>
                        </div>

                        <!-- 下半部：結果 -->
                        <div class="h-1/2 flex overflow-hidden">
                            <!-- 數據儀表 -->
                            <div class="w-1/3 p-6 border-r border-slate-200 bg-white flex flex-col overflow-y-auto items-center justify-center">
                                <div class="mb-4 text-center">
                                    <div class="text-xs text-slate-400 font-bold uppercase mb-2" data-i18n="score_total">總體相似度</div>
                                    <div class="relative inline-flex items-center justify-center">
                                        <svg class="w-28 h-28 transform -rotate-90">
                                            <circle cx="56" cy="56" r="48" stroke="#e2e8f0" stroke-width="8" fill="none"/>
                                            <circle id="score-ring" cx="56" cy="56" r="48" stroke="#7c3aed" stroke-width="8" fill="none" stroke-dasharray="301" stroke-dashoffset="301" stroke-linecap="round" class="transition-all duration-1000"/>
                                        </svg>
                                        <span class="absolute text-3xl font-black text-slate-800" id="score-display">--<span class="text-base text-slate-300 font-normal">%</span></span>
                                    </div>
                                </div>
                                <div class="w-full h-40">
                                    <canvas id="radarChart"></canvas>
                                </div>
                            </div>

                            <!-- AI 報告 -->
                            <div class="w-2/3 p-6 bg-slate-50 overflow-y-auto custom-scrollbar relative">
                                <div id="loading-state" class="hidden absolute inset-0 bg-slate-50/80 backdrop-blur z-10 flex flex-col items-center justify-center text-research-600">
                                    <div class="loader mb-3"></div>
                                    <p class="text-sm animate-pulse font-bold" data-i18n="msg_analyzing">AI 正在進行多維度運算...</p>
                                </div>
                                
                                <div id="empty-state" class="h-full flex flex-col items-center justify-center text-slate-300">
                                    <i class="fa-solid fa-chart-pie text-5xl mb-4 opacity-50"></i>
                                    <p data-i18n="msg_placeholder">請輸入文本並執行分析以查看報告</p>
                                </div>

                                <div id="result-content" class="hidden animate-fade-in">
                                    <h3 class="text-lg font-bold text-slate-700 mb-4 flex items-center">
                                        <i class="fa-solid fa-robot mr-2 text-research-600"></i> <span data-i18n="ai_title">AI 深度洞察報告</span>
                                    </h3>
                                    <div id="ai-text" class="text-sm text-slate-600 leading-relaxed space-y-4 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm"></div>
                                    
                                    <div class="grid grid-cols-3 gap-4 mt-6">
                                        <div class="bg-white p-3 rounded-xl border border-slate-100 shadow-sm text-center">
                                            <div class="text-xs text-slate-400 mb-1">結構</div>
                                            <div class="font-mono font-bold text-indigo-600" id="detail-structure">--</div>
                                        </div>
                                        <div class="bg-white p-3 rounded-xl border border-slate-100 shadow-sm text-center">
                                            <div class="text-xs text-slate-400 mb-1">概念</div>
                                            <div class="font-mono font-bold text-emerald-600" id="detail-concept">--</div>
                                        </div>
                                        <div class="bg-white p-3 rounded-xl border border-slate-100 shadow-sm text-center">
                                            <div class="text-xs text-slate-400 mb-1">語意</div>
                                            <div class="font-mono font-bold text-purple-600" id="detail-semantic">--</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzcDKkz8Tilzb3qbx0_fDR7QoG4-c2JCtsa4p9V8_1gBjZaEMlvQHd72OD0kZq_jW8H/exec";

        // 1. 權限檢查
        const userJson = sessionStorage.getItem("currentUser");
        const currentUser = userJson ? JSON.parse(userJson) : { name: "訪客研究員", role: "Researcher" };
        document.getElementById("user-name-display").innerText = currentUser.name;
        document.getElementById("user-avatar").innerText = currentUser.name.charAt(0).toUpperCase();

        // 2. i18n
        const translations = {
            "zh-TW": {
                "role_researcher": "研究專區", "welcome_researcher": "科學文本研究中心", "select_tool": "請選擇高階文本分析工具",
                "back_dashboard": "返回研究中心", "panel_config": "分析模型設定", 
                "dim_structure": "結構層", "dim_concept": "概念層", "dim_semantic": "語意層",
                "feat_r_1": "科學文本斷詞", "feat_r_2": "科學文本查詢", "feat_r_3": "文本詞彙比較", "feat_r_4": "文本可讀性分析",
                "feat_r_5": "概念網絡分析", "feat_r_6": "系統功能語言分析", "feat_r_7": "文本文字雲系統", "feat_r_8": "文本相似性分析",
                "btn_analyze": "執行分析", "section_input": "文本輸入", "btn_example": "載入範例", "btn_clear": "清空",
                "score_total": "總體相似度", "msg_analyzing": "AI 正在進行多維度運算...", "ai_title": "AI 深度洞察報告", "msg_placeholder": "請輸入文本並執行分析以查看報告",
                "err_input": "請輸入兩段文本！", "logout": "登出"
            },
            "en": {
                "role_researcher": "Researcher Zone", "welcome_researcher": "Science Text Research Center", "select_tool": "Advanced Text Analysis Tools",
                "back_dashboard": "Back to Hub", "panel_config": "Analysis Config",
                "dim_structure": "Structure", "dim_concept": "Concept", "dim_semantic": "Semantic",
                "feat_r_1": "Segmentation", "feat_r_2": "Text Query", "feat_r_3": "Vocabulary Comp.", "feat_r_4": "Readability",
                "feat_r_5": "Concept Net", "feat_r_6": "System Functional Ling.", "feat_r_7": "Word Cloud", "feat_r_8": "Similarity Analysis",
                "btn_analyze": "Run Analysis", "section_input": "Text Input", "btn_example": "Example", "btn_clear": "Clear",
                "score_total": "Similarity", "msg_analyzing": "Computing...", "ai_title": "AI Insight", "msg_placeholder": "Results will appear here...",
                "err_input": "Please input both texts!", "logout": "Logout"
            },
            "ja": {
                "role_researcher": "研究ゾーン", "welcome_researcher": "科学テキスト研究センター", "select_tool": "分析ツールを選択",
                "back_dashboard": "ハブに戻る", "panel_config": "分析設定",
                "dim_structure": "構造層", "dim_concept": "概念層", "dim_semantic": "意味層",
                "feat_r_1": "テキスト分かち書き", "feat_r_2": "テキスト検索", "feat_r_3": "語彙比較", "feat_r_4": "可読性分析",
                "feat_r_5": "概念ネットワーク", "feat_r_6": "体系機能言語学", "feat_r_7": "ワードクラウド", "feat_r_8": "類似性分析",
                "btn_analyze": "分析実行", "section_input": "テキスト入力", "btn_example": "例文", "btn_clear": "クリア",
                "score_total": "総合類似度", "msg_analyzing": "計算中...", "ai_title": "AI インサイト", "msg_placeholder": "結果はここに表示されます...",
                "err_input": "両方のテキストを入力してください！", "logout": "ログアウト"
            },
            "zh-CN": {
                "role_researcher": "研究专区", "welcome_researcher": "科学文本研究中心", "select_tool": "请选择高阶文本分析工具",
                "back_dashboard": "返回研究中心", "panel_config": "分析模型设置", 
                "dim_structure": "结构层", "dim_concept": "概念层", "dim_semantic": "语义层",
                "feat_r_1": "科学文本断词", "feat_r_2": "科学文本查询", "feat_r_3": "文本词汇比较", "feat_r_4": "文本可读性分析",
                "feat_r_5": "概念网络分析", "feat_r_6": "系统功能语言分析", "feat_r_7": "文本文字雲系統", "feat_r_8": "文本相似性分析",
                "btn_analyze": "执行分析", "section_input": "文本输入", "btn_example": "载入范例", "btn_clear": "清空",
                "score_total": "总体相似度", "msg_analyzing": "正在进行深度运算...", "ai_title": "AI 深度洞察报告", "msg_placeholder": "请输入文本并执行分析以查看报告",
                "err_input": "请输入两段文本！", "logout": "登出"
            }
        };

        const examples = {
            "zh-TW": { a: "細胞是生物體結構和功能的基本單位。細胞膜控制物質進出，細胞核含有遺傳物質DNA。", b: "生物體由細胞組成，細胞是生命的基本單位。外層有細胞膜負責物質運輸，核心有DNA負責遺傳。" },
            "en": { a: "The cell is the basic structural and functional unit of life.", b: "Living organisms are made of cells, which are the fundamental units." },
            "ja": { a: "細胞は生物の構造と機能の基本単位です。", b: "生物は細胞から構成されており、生命の基本単位です。" },
            "zh-CN": { a: "细胞是生物体结构和功能的基本单位。", b: "生物体由细胞组成，细胞是生命的基本单位。" }
        };

        let currentLang = 'zh-TW';
        let radarChart = null;

        function changeLanguage() {
            currentLang = document.getElementById('language-selector').value;
            const t = translations[currentLang] || translations['zh-TW'];
            document.querySelectorAll('[data-i18n]').forEach(el => { el.innerText = t[el.getAttribute('data-i18n')]; });
        }

        // --- UI 切換 ---
        function openTool(toolId) {
            document.getElementById("dashboard-view").classList.add("hidden-section");
            document.getElementById("tool-container").classList.remove("hidden-section");
            
            // 如果是相似性分析，顯示內嵌的 tool-similarity
            if (toolId === 'similarity') {
                document.getElementById("tool-similarity").classList.remove("hidden-section");
            }
        }

        function backToDashboard() {
            document.getElementById("tool-container").classList.add("hidden-section");
            document.getElementById("dashboard-view").classList.remove("hidden-section");
        }

        function logout() {
            if(confirm("確定要登出嗎？")) {
                sessionStorage.removeItem("currentUser");
                window.location.href = "index.html";
            }
        }

        // --- 文本分析邏輯 ---
        function loadExample() {
            const ex = examples[currentLang] || examples['zh-TW'];
            document.getElementById('text-a').value = ex.a;
            document.getElementById('text-b').value = ex.b;
        }

        function clearText() {
            document.getElementById('text-a').value = '';
            document.getElementById('text-b').value = '';
            document.getElementById('text-a').focus();
        }

        function syncScroll(src, dest) {
            const s = document.getElementById(src);
            const d = document.getElementById(dest);
            const pct = s.scrollTop / (s.scrollHeight - s.clientHeight);
            d.scrollTop = pct * (d.scrollHeight - d.clientHeight);
        }

        function initChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Structure', 'Concept', 'Semantic'],
                    datasets: [{
                        label: 'Score',
                        data: [0, 0, 0],
                        backgroundColor: 'rgba(124, 58, 237, 0.2)',
                        borderColor: '#7c3aed',
                        pointBackgroundColor: '#7c3aed',
                        pointBorderColor: '#fff'
                    }]
                },
                options: {
                    scales: { r: { beginAtZero: true, max: 100, ticks: { display: false } } },
                    plugins: { legend: { display: false } },
                    responsive: true, maintainAspectRatio: false
                }
            });
        }

        function runAnalysis() {
            const tA = document.getElementById('text-a').value.trim();
            const tB = document.getElementById('text-b').value.trim();
            const t = translations[currentLang] || translations['zh-TW'];

            if (!tA || !tB) { alert(t.err_input); return; }

            // UI State
            const btn = document.getElementById('btn-analyze');
            const originalBtn = btn.innerHTML;
            btn.disabled = true;
            
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('result-content').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');

            const payload = { textA: tA, textB: tB };

            fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors', 
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }).then(() => {
                // 模擬後端運算 (Mock Data)
                setTimeout(() => {
                    const mockData = {
                        scores: { total: 85, structure: 65, semantic: 92, concept: 88 },
                        details: {
                            aiAnalysis: `
                                <h4 class='font-bold text-indigo-700 mb-2'>語意與概念差異分析</h4>
                                <p>這兩段文本在<strong>語意上高度相似</strong>。文本 A 較為學術，明確定義了「單位」與「功能」；文本 B 則較為口語化。概念層面上，兩者都涵蓋了「細胞膜-運輸」與「細胞核-遺傳」的對應關係。</p>
                                <h4 class='font-bold text-purple-700 mb-2 mt-4'>教學應用建議</h4>
                                <p>教師可將文本 A 作為<strong>標準定義</strong>，文本 B 作為<strong>解釋性輔助</strong>。</p>
                            `
                        }
                    };
                    
                    // Update UI
                    const circle = document.getElementById('score-ring');
                    const radius = 48;
                    const circumference = 2 * Math.PI * radius;
                    const offset = circumference - (mockData.scores.total / 100) * circumference;
                    circle.style.strokeDashoffset = offset;
                    document.getElementById('score-display').innerHTML = `${mockData.scores.total}<span class="text-lg text-slate-300 font-normal">%</span>`;

                    radarChart.data.datasets[0].data = [mockData.scores.structure, mockData.scores.semantic, mockData.scores.concept];
                    radarChart.update();

                    document.getElementById('detail-structure').innerText = mockData.scores.structure + '%';
                    document.getElementById('detail-concept').innerText = mockData.scores.concept + '%';
                    document.getElementById('detail-semantic').innerText = mockData.scores.semantic + '%';
                    document.getElementById('ai-text').innerHTML = mockData.details.aiAnalysis;

                    document.getElementById('result-content').classList.remove('hidden');
                    document.getElementById('loading-state').classList.add('hidden');
                    btn.disabled = false;
                    btn.innerHTML = originalBtn;
                }, 2000);
            });
        }

        // Canvas Background
        (function() {
            const canvas = document.getElementById('network-canvas');
            const ctx = canvas.getContext('2d');
            let width, height, orbits = [], centerX, centerY;
            function resize() { width=window.innerWidth; height=window.innerHeight; canvas.width=width; canvas.height=height; centerX=width/2; centerY=height/2; initOrbits(); }
            class Orbit { constructor(rx, ry, a, c, s) { this.rx=rx; this.ry=ry; this.a=a; this.c=c; this.s=s; this.r=0; this.ea=Math.random()*Math.PI*2; } update(){ this.r+=this.s; this.ea+=0.002; } draw(){ ctx.save(); ctx.translate(centerX, centerY); ctx.rotate(this.a); ctx.beginPath(); ctx.ellipse(0,0,this.rx,this.ry,this.r,0,Math.PI*2); ctx.strokeStyle=this.c; ctx.lineWidth=1; ctx.stroke(); ctx.beginPath(); ctx.arc(this.rx*Math.cos(this.ea), this.ry*Math.sin(this.ea), 3, 0, Math.PI*2); ctx.fillStyle=this.c; ctx.fill(); ctx.restore(); } }
            function initOrbits() { orbits=[]; const br=width<height?width*0.25:height*0.3; orbits.push(new Orbit(br, br*0.4, Math.PI/4, 'rgba(139,92,246,0.2)', 0.001)); orbits.push(new Orbit(br, br*0.4, -Math.PI/4, 'rgba(124,58,237,0.2)', -0.001)); orbits.push(new Orbit(br*1.2, br*1.2, 0, 'rgba(76,29,149,0.1)', 0.0005)); }
            function animate() { ctx.clearRect(0,0,width,height); orbits.forEach(o=>{o.update();o.draw()}); ctx.beginPath(); ctx.arc(centerX, centerY, 5, 0, Math.PI*2); ctx.fillStyle='rgba(139,92,246,0.8)'; ctx.shadowBlur=15; ctx.shadowColor='#8b5cf6'; ctx.fill(); requestAnimationFrame(animate); }
            window.addEventListener('resize', resize); resize(); animate();
        })();

        window.onload = () => { initChart(); changeLanguage(); };
    </script>
</body>
</html>
