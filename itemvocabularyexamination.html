<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>命題用語檢核 | Science Learning Hub</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        teacher: { light: '#bbf7d0', DEFAULT: '#22c55e', dark: '#15803d' },
                        glass: {
                            100: 'rgba(255, 255, 255, 0.1)',
                            200: 'rgba(255, 255, 255, 0.2)',
                            700: 'rgba(255, 255, 255, 0.7)',
                            900: 'rgba(255, 255, 255, 0.9)',
                        }
                    },
                    fontFamily: {
                        sans: ['ui-sans-serif', 'system-ui', '-apple-system', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', 'sans-serif'],
                    },
                    animation: {
                        "spin-slow": "spin 10s linear infinite",
                        "gradient-x": "gradient-x 15s ease infinite",
                        "fade-in-up": "fadeInUp 0.5s ease-out forwards",
                    },
                    keyframes: {
                        "gradient-x": {
                            "0%, 100%": { "background-size": "200% 200%", "background-position": "left center" },
                            "50%": { "background-size": "200% 200%", "background-position": "right center" }
                        },
                        "fadeInUp": {
                            "0%": { opacity: "0", transform: "translateY(10px)" },
                            "100%": { opacity: "1", transform: "translateY(0)" }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* 玻璃擬態與背景樣式 (與 Teacher.html 一致) */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 135, 38, 0.1);
        }
        
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; overflow: hidden;
            background: linear-gradient(-45deg, #f0fdf4, #ecfdf5, #f0f9ff, #f8fafc);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }

        /* 輸入框聚焦特效 */
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }

        /* 標籤樣式 */
        .tag-fit { @apply bg-green-100 text-green-700 border border-green-200; }
        .tag-adv1 { @apply bg-yellow-100 text-yellow-700 border border-yellow-200; }
        .tag-adv2 { @apply bg-red-100 text-red-700 border border-red-200; }
        .tag-unseen { @apply bg-gray-100 text-gray-600 border border-gray-200; }

        /* 載入動畫 */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #22c55e;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen font-sans flex flex-col text-slate-800 relative overflow-x-hidden selection:bg-green-200 selection:text-green-900">

    <!-- 背景動態層 -->
    <div id="canvas-container">
        <canvas id="network-canvas"></canvas>
    </div>

    <!-- 頂部導航列 -->
    <nav class="glass-panel sticky top-0 z-50 border-b-0">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="window.location.href='teacher.html'">
                <div class="bg-green-100 p-2 rounded-xl text-green-600 shadow-sm transition hover:scale-105">
                    <i class="fa-solid fa-arrow-left text-lg"></i>
                </div>
                <span class="text-xl font-bold tracking-tight text-slate-800">返回教學中心</span>
            </div>
            <div class="flex items-center space-x-4">
                <span class="bg-green-50 text-green-700 px-4 py-1.5 rounded-full text-sm font-bold border border-green-200 shadow-sm">
                    <i class="fa-solid fa-check-double mr-2"></i>命題檢核系統
                </span>
            </div>
        </div>
    </nav>

    <!-- 主內容區 -->
    <main class="flex-1 overflow-y-auto p-6 md:p-10 relative z-10">
        <div class="max-w-7xl mx-auto animate-fade-in-up">
            
            <!-- 標題區 -->
            <div class="text-center mb-10">
                <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-700 to-teal-600 mb-2 filter drop-shadow-sm">
                    中小學自然科命題用詞 AI 檢核
                </h1>
                <p class="text-slate-500">透過 AI 分析試題詞彙，確保命題符合學生認知發展階段</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- 左側：設定與輸入區 -->
                <div class="lg:col-span-4 space-y-6">
                    <!-- 參數設定卡片 -->
                    <div class="glass-panel p-6 rounded-3xl">
                        <h2 class="text-lg font-bold text-slate-700 mb-4 flex items-center">
                            <i class="fa-solid fa-sliders mr-2 text-green-600"></i> 參數設定
                        </h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-1">學習階段 <span class="text-red-500">*</span></label>
                                <select id="stage" class="w-full p-3 rounded-xl border border-slate-200 bg-white/80 input-focus outline-none transition" onchange="updateGrades()">
                                    <option value="" disabled selected>請選擇階段</option>
                                    <option value="國小">國小 (Elementary)</option>
                                    <option value="國中">國中 (Junior High)</option>
                                    <option value="高中" disabled>高中 (Senior High) - 建置中</option>
                                </select>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-bold text-slate-600 mb-1">年級</label>
                                    <select id="grades" class="w-full p-3 rounded-xl border border-slate-200 bg-white/80 input-focus outline-none transition disabled:bg-slate-100 disabled:text-slate-400" disabled>
                                        <option value="" selected>不限</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-slate-600 mb-1">學期</label>
                                    <select id="semester" class="w-full p-3 rounded-xl border border-slate-200 bg-white/80 input-focus outline-none transition">
                                        <option value="" selected>不限</option>
                                        <option value="上">上學期</option>
                                        <option value="下">下學期</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-1">教科書版本</label>
                                <select id="version" class="w-full p-3 rounded-xl border border-slate-200 bg-white/80 input-focus outline-none transition">
                                    <option value="" selected>不限</option>
                                    <option value="康軒">康軒</option>
                                    <option value="翰林">翰林</option>
                                    <option value="南一">南一</option>
                                </select>
                            </div>

                            <div class="pt-2">
                                <label class="block text-sm font-bold text-slate-600 mb-2">檢測詞性 (多選)</label>
                                <div class="flex flex-wrap gap-2">
                                    <label class="cursor-pointer select-none bg-white border border-slate-200 px-3 py-1.5 rounded-lg hover:bg-green-50 transition flex items-center">
                                        <input type="checkbox" name="pos" value="N" checked class="accent-green-600 mr-2"> 名詞 (N)
                                    </label>
                                    <label class="cursor-pointer select-none bg-white border border-slate-200 px-3 py-1.5 rounded-lg hover:bg-green-50 transition flex items-center">
                                        <input type="checkbox" name="pos" value="V" checked class="accent-green-600 mr-2"> 動詞 (V)
                                    </label>
                                    <label class="cursor-pointer select-none bg-white border border-slate-200 px-3 py-1.5 rounded-lg hover:bg-green-50 transition flex items-center">
                                        <input type="checkbox" name="pos" value="A" class="accent-green-600 mr-2"> 形容詞 (A)
                                    </label>
                                    <label class="cursor-pointer select-none bg-white border border-slate-200 px-3 py-1.5 rounded-lg hover:bg-green-50 transition flex items-center">
                                        <input type="checkbox" name="pos" value="D" class="accent-green-600 mr-2"> 副詞 (D)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 執行按鈕 -->
                    <button id="runBtn" onclick="runCheck()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 rounded-2xl hover:shadow-lg hover:shadow-green-500/30 transition font-bold text-lg transform active:scale-95 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <span>開始檢測</span>
                    </button>
                </div>

                <!-- 右側：文本輸入與結果 -->
                <div class="lg:col-span-8 space-y-6">
                    
                    <!-- 文本輸入區 -->
                    <div class="glass-panel p-6 rounded-3xl relative group">
                        <label class="block font-bold mb-3 text-slate-700 flex justify-between items-center">
                            <span class="flex items-center gap-2"><i class="fa-regular fa-file-lines"></i> 試題文本</span>
                            <span class="text-xs font-normal text-slate-400 bg-white px-2 py-1 rounded-md border border-slate-100">建議包含題幹與選項</span>
                        </label>
                        <textarea id="text" class="w-full h-64 p-5 border border-white/60 rounded-2xl input-focus transition resize-none bg-white/50 text-slate-700 leading-relaxed text-lg placeholder-slate-400 scrollbar-thin" placeholder="在此貼上命題內容...
例如：
1. 下列關於光合作用的敘述，何者正確？
(A) 主要在根部進行
(B) 產物包含葡萄糖"></textarea>
                        <!-- 裝飾光暈 -->
                        <div class="absolute -bottom-4 -right-4 w-20 h-20 bg-green-400/20 rounded-full blur-2xl -z-10"></div>
                    </div>

                    <!-- 結果顯示區 (預設隱藏) -->
                    <div id="result-area" class="hidden space-y-6 animate-fade-in-up">
                        
                        <!-- KPI 摘要卡片 -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm text-center">
                                <div class="text-xs text-slate-500 mb-1">總詞彙數</div>
                                <div class="text-2xl font-black text-slate-800" id="kpi-total">0</div>
                            </div>
                            <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm text-center">
                                <div class="text-xs text-slate-500 mb-1">適切性</div>
                                <div class="text-2xl font-black text-green-600" id="kpi-coverage">0%</div>
                            </div>
                            <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm text-center">
                                <div class="text-xs text-slate-500 mb-1">超前詞彙</div>
                                <div class="text-2xl font-black text-yellow-600" id="kpi-adv">0</div>
                            </div>
                            <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm text-center">
                                <div class="text-xs text-slate-500 mb-1">未見詞彙</div>
                                <div class="text-2xl font-black text-red-500" id="kpi-unseen">0</div>
                            </div>
                        </div>

                        <!-- AI 回饋區 -->
                        <div class="glass-panel p-6 rounded-3xl border-l-8 border-green-500">
                            <h3 class="font-bold text-green-800 text-lg mb-3 flex items-center">
                                <i class="fa-solid fa-robot mr-2"></i> AI 審查建議
                            </h3>
                            <div id="ai-feedback-content" class="text-slate-700 leading-relaxed space-y-2 text-sm">
                                <!-- JS 填入內容 -->
                            </div>
                        </div>

                        <!-- 詳細表格 -->
                        <div class="glass-panel p-6 rounded-3xl overflow-hidden">
                            <h3 class="font-bold text-slate-700 mb-4">詞彙詳細分析</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr class="text-slate-500 text-sm border-b border-slate-200/60">
                                            <th class="pb-3 pl-2 font-medium">詞彙</th>
                                            <th class="pb-3 font-medium">詞性</th>
                                            <th class="pb-3 font-medium">首次出現</th>
                                            <th class="pb-3 font-medium">狀態</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body" class="text-slate-700 text-sm">
                                        <!-- JS 填入內容 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- 提示訊息 (Toast) -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-xl transition-all duration-300 opacity-0 translate-y-10 z-50 flex items-center gap-3 pointer-events-none">
        <i class="fa-solid fa-circle-info text-yellow-400"></i>
        <span id="toast-msg">提示訊息</span>
    </div>

    <script>
        // 1. 連動邏輯：學習階段 -> 年級
        function updateGrades() {
            const stage = document.getElementById('stage').value;
            const gradeSelect = document.getElementById('grades');
            const versionSelect = document.getElementById('version');
            
            // 清空並重置年級
            gradeSelect.innerHTML = '<option value="" selected>不限</option>';
            
            if (stage === '國小') {
                const grades = ['一年級', '二年級', '三年級', '四年級', '五年級', '六年級'];
                grades.forEach(g => {
                    const opt = document.createElement('option');
                    opt.value = g;
                    opt.text = g;
                    gradeSelect.appendChild(opt);
                });
                gradeSelect.disabled = false;
            } else if (stage === '國中') {
                const grades = ['七年級', '八年級', '九年級'];
                grades.forEach(g => {
                    const opt = document.createElement('option');
                    opt.value = g;
                    opt.text = g;
                    gradeSelect.appendChild(opt);
                });
                gradeSelect.disabled = false;
            } else {
                gradeSelect.disabled = true;
            }
            
            // 版本選單重置
            versionSelect.value = "";
        }

        // 2. 顯示 Toast 提示
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }

        // 3. 執行檢測 (前端模擬邏輯 + 介面互動)
        function runCheck() {
            const stage = document.getElementById('stage').value;
            const text = document.getElementById('text').value.trim();
            const btn = document.getElementById('runBtn');

            // 防呆檢查
            if (!stage) {
                showToast('請選擇學習階段！');
                document.getElementById('stage').focus();
                return;
            }
            if (!text) {
                showToast('請輸入命題文本內容！');
                document.getElementById('text').focus();
                return;
            }

            // Loading 狀態
            const originalBtnContent = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<div class="loader mr-2"></div> 分析中...';
            
            // 隱藏舊結果
            document.getElementById('result-area').classList.add('hidden');

            // 模擬後端延遲 (實際應呼叫 google.script.run)
            setTimeout(() => {
                // 恢復按鈕
                btn.disabled = false;
                btn.innerHTML = originalBtnContent;

                // 顯示結果 (這裡使用假資料模擬，您之後需接上 google.script.run 的 successHandler)
                renderMockResults(text);
                
                // 滾動到結果區
                document.getElementById('result-area').classList.remove('hidden');
                document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });

            }, 1500);
        }

        // 4. 渲染模擬結果 (當沒有後端時的展示)
        function renderMockResults(inputText) {
            // KPI
            document.getElementById('kpi-total').innerText = inputText.length > 10 ? Math.floor(Math.random() * 20 + 10) : 0;
            document.getElementById('kpi-coverage').innerText = '85%';
            document.getElementById('kpi-adv').innerText = '3';
            document.getElementById('kpi-unseen').innerText = '1';

            // AI Feedback
            const feedbackHtml = `
                <p><span class="font-bold text-green-700">優點：</span> 題幹敘述清晰，主要概念符合所選年級之認知發展。</p>
                <p class="mt-2"><span class="font-bold text-yellow-600">建議：</span> 詞彙「<span class="bg-yellow-100 px-1 rounded">葉綠體</span>」在該年級尚未正式教授，建議加註說明或改為「植物綠色部分」。</p>
            `;
            document.getElementById('ai-feedback-content').innerHTML = feedbackHtml;

            // Table
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = `
                <tr class="border-b border-slate-100 hover:bg-green-50/50 transition">
                    <td class="py-3 pl-2 font-medium">光合作用</td>
                    <td class="py-3 text-slate-500">N</td>
                    <td class="py-3 text-slate-500">國小五年級</td>
                    <td class="py-3"><span class="tag-fit px-2 py-0.5 rounded text-xs font-bold">符合</span></td>
                </tr>
                <tr class="border-b border-slate-100 hover:bg-green-50/50 transition">
                    <td class="py-3 pl-2 font-medium">葉綠體</td>
                    <td class="py-3 text-slate-500">N</td>
                    <td class="py-3 text-slate-500">國中七年級</td>
                    <td class="py-3"><span class="tag-adv2 px-2 py-0.5 rounded text-xs font-bold">超前</span></td>
                </tr>
                 <tr class="border-b border-slate-100 hover:bg-green-50/50 transition">
                    <td class="py-3 pl-2 font-medium">葡萄糖</td>
                    <td class="py-3 text-slate-500">N</td>
                    <td class="py-3 text-slate-500">--</td>
                    <td class="py-3"><span class="tag-unseen px-2 py-0.5 rounded text-xs font-bold">未見</span></td>
                </tr>
            `;
        }

        // 5. Canvas 動畫 (綠色系)
        (function() {
            const canvas = document.getElementById('network-canvas');
            const ctx = canvas.getContext('2d');
            let width, height, orbits = [], centerX, centerY;

            function resize() {
                width = window.innerWidth; height = window.innerHeight;
                canvas.width = width; canvas.height = height;
                centerX = width / 2; centerY = height / 2;
                initOrbits();
            }

            class Orbit {
                constructor(rx, ry, angle, color, speed) {
                    this.rx = rx; this.ry = ry; this.tilt = angle; this.rotation = 0;
                    this.speed = speed * 0.5; this.color = color;
                    this.ea = Math.random() * Math.PI * 2; this.es = 0.002; 
                }
                draw() {
                    ctx.save(); ctx.translate(centerX, centerY); ctx.rotate(this.tilt);
                    ctx.beginPath(); ctx.ellipse(0, 0, this.rx, this.ry, this.rotation, 0, Math.PI * 2);
                    ctx.strokeStyle = this.color; ctx.lineWidth = 1; ctx.stroke();
                    const ex = this.rx * Math.cos(this.ea), ey = this.ry * Math.sin(this.ea);
                    ctx.beginPath(); ctx.arc(ex, ey, 3, 0, Math.PI*2); ctx.fillStyle = this.color; ctx.fill();
                    ctx.restore();
                }
                update() { this.rotation += this.speed; this.ea += this.es; }
            }

            function initOrbits() {
                orbits = []; 
                const br = width < height ? width * 0.25 : height * 0.3;
                orbits.push(new Orbit(br, br * 0.4, Math.PI / 4, 'rgba(34, 197, 94, 0.3)', 0.001));
                orbits.push(new Orbit(br, br * 0.4, -Math.PI / 4, 'rgba(16, 185, 129, 0.3)', -0.001));
                orbits.push(new Orbit(br * 1.2, br * 1.2, 0, 'rgba(6, 95, 70, 0.1)', 0.0005));
            }

            function animate() {
                ctx.clearRect(0, 0, width, height);
                orbits.forEach(o => { o.update(); o.draw(); });
                
                // Nucleus
                ctx.beginPath(); ctx.arc(centerX, centerY, 5, 0, Math.PI*2); 
                ctx.fillStyle = 'rgba(34, 197, 94, 0.8)'; ctx.shadowBlur = 15; ctx.shadowColor = '#22c55e'; ctx.fill();
                
                requestAnimationFrame(animate);
            }
            
            window.addEventListener('resize', resize);
            resize(); animate();
        })();
    </script>
</body>
</html>
