<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Key Ideas | Science Learning Hub</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        student: { light: '#bfdbfe', DEFAULT: '#3b82f6', dark: '#1d4ed8' },
                    },
                    animation: {
                        "fade-in-up": "fadeInUp 0.5s ease-out forwards",
                    },
                    keyframes: {
                        fadeInUp: {
                            "0%": { opacity: "0", transform: "translateY(20px)" },
                            "100%": { opacity: "1", transform: "translateY(0)" }
                        }
                    }
                }
            }
        }
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });
    </script>

    <style>
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        /* åˆ—å°æ™‚éš±è—ä¸éœ€è¦çš„å…ƒç´  */
        @media print {
            nav, #selection-panel, #floating-chat, .no-print { display: none !important; }
            body { background: white; }
            .glass-panel { box-shadow: none; border: 1px solid #ddd; }
        }
        
        /* ç§‘å­¸è©å½™è¢å…‰ç­†æ¨£å¼ */
        .sci-vocab {
            background-color: #fef08a; /* é»ƒåº• */
            color: #854d0e; /* æ·±è¤å­— */
            padding: 0 4px;
            border-radius: 4px;
            font-weight: 800; /* ç²—é«” */
            box-decoration-break: clone;
        }

        /* å·è»¸éš±è— */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* å°ç§‘ AI èŠå¤©è¦–çª—å‹•ç•« */
        .chat-window { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: bottom right; }
        .chat-window.closed { transform: scale(0); opacity: 0; pointer-events: none; }
    </style>
</head>
<body class="text-slate-800 font-sans">

    <nav class="glass-panel sticky top-0 z-50 w-full border-b border-white/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-4">
                    <a href="student.html" class="flex items-center justify-center w-10 h-10 rounded-full bg-white text-slate-500 hover:text-blue-600 hover:bg-blue-50 transition shadow-sm">
                        <i class="fa-solid fa-arrow-left"></i>
                    </a>
                    <div class="flex flex-col">
                        <span class="font-bold text-lg text-slate-800 tracking-tight">å–®å…ƒé‡é»å¯¦é©—å®¤</span>
                        <span class="text-xs text-slate-500">AI æ™ºèƒ½ç­†è¨˜ç”Ÿæˆ</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold text-sm" id="user-avatar">S</div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div id="selection-panel" class="glass-panel rounded-2xl p-6 mb-8 transition-all duration-500">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-filter text-blue-600"></i>
                    <h2 class="font-bold text-lg">é¸æ“‡å­¸ç¿’ç¯„åœ (è³‡æ–™ä¾†æºï¼šGoogle Sheet)</h2>
                </div>
                <div id="data-status" class="text-xs text-slate-400">æ­£åœ¨é€£ç·šè³‡æ–™åº«...</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">éšæ®µ (A)</label>
                    <select id="sel-stage" onchange="filterData('stage')" class="w-full rounded-xl border-slate-200 bg-white p-2.5 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500 outline-none">
                        <option value="" disabled selected>è¼‰å…¥ä¸­...</option>
                    </select>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">å‡ºç‰ˆç¤¾ (C)</label>
                    <select id="sel-publisher" onchange="filterData('publisher')" disabled class="w-full rounded-xl border-slate-200 bg-gray-50 p-2.5 text-sm shadow-sm disabled:opacity-50">
                        <option value="" disabled selected>è«‹å…ˆé¸éšæ®µ</option>
                    </select>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">å¹´ç´š (D)</label>
                    <select id="sel-grade" onchange="filterData('grade')" disabled class="w-full rounded-xl border-slate-200 bg-gray-50 p-2.5 text-sm shadow-sm disabled:opacity-50">
                        <option value="" disabled selected>è«‹å…ˆé¸å‡ºç‰ˆç¤¾</option>
                    </select>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">å­¸æœŸ (E)</label>
                    <select id="sel-semester" onchange="filterData('semester')" disabled class="w-full rounded-xl border-slate-200 bg-gray-50 p-2.5 text-sm shadow-sm disabled:opacity-50">
                        <option value="" disabled selected>è«‹å…ˆé¸å¹´ç´š</option>
                    </select>
                </div>

                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">å–®å…ƒ (H)</label>
                    <select id="sel-unit" disabled class="w-full rounded-xl border-slate-200 bg-gray-50 p-2.5 text-sm shadow-sm disabled:opacity-50">
                        <option value="" disabled selected>è«‹å…ˆé¸å­¸æœŸ</option>
                    </select>
                </div>
            </div>

            <div class="mt-6 flex justify-end">
                <button onclick="fetchAndGenerate()" id="btn-generate" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-8 rounded-xl shadow-lg shadow-blue-500/30 transition transform active:scale-95 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                    <span>AI åˆ†æä¸¦ç”Ÿæˆé‡é»</span>
                </button>
            </div>
        </div>

        <div id="loading-view" class="hidden flex-col items-center justify-center py-20">
            <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
            <h3 class="text-xl font-bold text-slate-700">AI æ­£åœ¨é–±è®€èª²æ–‡...</h3>
            <p class="text-slate-500 mt-2">æ­£åœ¨æå–ã€Œ<span id="loading-unit-name" class="font-bold"></span>ã€çš„é—œéµæ¦‚å¿µèˆ‡è¿·æ€...</p>
        </div>

        <div id="content-view" class="hidden animate-fade-in-up">
            
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <div>
                    <span class="inline-block px-3 py-1 bg-blue-100 text-blue-600 rounded-full text-xs font-bold tracking-wider mb-2" id="result-tag">SCIENCE</span>
                    <h1 class="text-3xl font-black text-slate-800" id="result-title">å–®å…ƒæ¨™é¡Œ</h1>
                </div>
                <div class="flex gap-2 no-print">
                    <button onclick="window.print()" class="bg-white hover:bg-slate-50 text-slate-600 font-medium py-2 px-4 rounded-lg border border-slate-200 shadow-sm transition">
                        <i class="fa-solid fa-print mr-1"></i> PDF / åˆ—å°
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <div class="md:col-span-2 glass-panel rounded-2xl p-6 border-l-4 border-blue-500 bg-white">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2 text-blue-800">
                        <i class="fa-solid fa-star text-yellow-400"></i> <span>å–®å…ƒæ ¸å¿ƒæ‘˜è¦ (Based on Text)</span>
                    </h3>
                    <div class="prose prose-blue max-w-none text-slate-600 leading-relaxed text-lg" id="summary-text">
                        </div>
                </div>

                <div class="glass-panel rounded-2xl p-6 bg-gradient-to-br from-white to-blue-50">
                    <h3 class="font-bold text-lg mb-4 text-slate-700">ç§‘å­¸è©å½™ (Vocab)</h3>
                    <div class="space-y-3 max-h-[400px] overflow-y-auto pr-2" id="keywords-list">
                        </div>
                </div>

                <div class="md:col-span-3 glass-panel rounded-2xl p-6 overflow-hidden bg-white">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2 text-purple-700">
                        <i class="fa-solid fa-project-diagram"></i> <span>çŸ¥è­˜æ¶æ§‹åœ– (AI Knowledge Map)</span>
                    </h3>
                    <div class="w-full overflow-x-auto bg-slate-50 rounded-xl p-4 flex justify-center border border-slate-100">
                        <div class="mermaid" id="mermaid-chart">
                            </div>
                    </div>
                </div>

                <div class="md:col-span-3 glass-panel rounded-2xl p-6 border border-red-100 bg-red-50/30">
                    <h3 class="font-bold text-lg mb-4 text-red-600 flex items-center gap-2">
                        <i class="fa-solid fa-triangle-exclamation"></i> <span>å¸¸è¦‹è¿·æ€èˆ‡é™·é˜± (AI Detected)</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="myth-list">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <div id="floating-chat" class="fixed bottom-6 right-6 z-[100] flex flex-col items-end gap-4">
        
        <div id="xiaoke-window" class="chat-window closed w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 flex flex-col overflow-hidden h-[500px]">
            <div class="bg-blue-600 p-4 text-white flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fa-solid fa-robot"></i></div>
                    <span class="font-bold">å°ç§‘ AI åŠ©æ•™</span>
                </div>
                <button onclick="toggleChat()" class="text-white/80 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="flex-1 p-4 bg-slate-50 overflow-y-auto text-sm space-y-3" id="chat-messages">
                <div class="bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-slate-100 max-w-[85%]">
                    å—¨ï¼æˆ‘æ˜¯å°ç§‘ ğŸ‘‹<br>é—œæ–¼é€™å€‹å–®å…ƒï¼Œæœ‰ä»€éº¼ä¸æ‡‚çš„åœ°æ–¹éƒ½å¯ä»¥å•æˆ‘å–”ï¼
                </div>
            </div>
            <div class="p-3 bg-white border-t border-slate-100 flex gap-2">
                <input type="text" placeholder="è¼¸å…¥å•é¡Œ..." class="flex-1 bg-slate-100 border-none rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                <button class="bg-blue-600 text-white w-10 h-10 rounded-full hover:bg-blue-700 transition flex items-center justify-center">
                    <i class="fa-solid fa-paper-plane text-xs"></i>
                </button>
            </div>
        </div>

        <button onclick="toggleChat()" class="w-14 h-14 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full shadow-lg shadow-blue-600/30 text-white flex items-center justify-center text-2xl hover:scale-110 transition duration-300 group">
            <i class="fa-solid fa-comment-dots group-hover:animate-pulse"></i>
        </button>
    </div>

    <script>
        // æ‚¨çš„ GAS Web App URL (éƒ¨ç½²å¾Œè«‹å¡«å…¥é€™è£¡)
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbx3MW-IOcU-38IqgawidSakL9nVwARmov4cuK0S6Jcqbv3SJFyHUbrvrI43Y6nskJAx/exec"; 
        
        let fullData = []; // å„²å­˜å¾ Sheet æŠ“å›ä¾†çš„æ‰€æœ‰æ¸…å–®è³‡æ–™
        
        // 1. åˆå§‹åŒ–ï¼šæŠ“å– Sheet è³‡æ–™
        window.addEventListener('DOMContentLoaded', async () => {
            document.getElementById("data-status").innerText = "æ­£åœ¨åŒæ­¥é›²ç«¯èª²ç¶±...";
            
            try {
                // æ¨¡æ“¬ç¬¬ä¸€æ¬¡æŠ“å– (å¯¦éš›æ‡‰ç”¨è«‹è§£é–‹ä¸‹è¡Œè¨»è§£ä¸¦å¡«å…¥æ­£ç¢º URL)
                // const res = await fetch(`${GAS_API_URL}?action=get_metadata`);
                // const json = await res.json();
                // fullData = json.data;

                // --- è‡¨æ™‚æ¨¡æ“¬è³‡æ–™ (å› ç‚ºæˆ‘ç„¡æ³•å­˜å–æ‚¨çš„ GAS) ---
                // --- æ­£å¼ä½¿ç”¨æ™‚ï¼Œè«‹å°‡é€™è£¡æ›¿æ›ç‚ºä¸Šè¿° fetch ---
                fullData = [
                   { stage: "åœ‹å°", publisher: "å—ä¸€", grade: "3", semester: "ä¸Š", unit: "èªè­˜æ¤ç‰©" },
                   { stage: "åœ‹å°", publisher: "å—ä¸€", grade: "3", semester: "ä¸Š", unit: "ç©ºæ°£èˆ‡é¢¨" },
                   { stage: "åœ‹ä¸­", publisher: "ç¿°æ—", grade: "7", semester: "ä¸‹", unit: "ç”Ÿç‰©çš„åˆ†é¡" }
                ];
                // ---------------------------------------------

                document.getElementById("data-status").innerText = "è³‡æ–™åº«é€£ç·šæˆåŠŸ";
                document.getElementById("data-status").className = "text-xs text-green-600 font-bold";
                populateSelect('stage');
            } catch (e) {
                console.error(e);
                document.getElementById("data-status").innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯";
                document.getElementById("data-status").className = "text-xs text-red-500";
            }
        });

        // 2. ç¯©é¸é‚è¼¯ (Cascading Dropdowns)
        function populateSelect(targetId) {
            const el = document.getElementById(`sel-${targetId}`);
            el.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡...</option>';
            el.disabled = false;
            
            // å–å¾—ç•¶å‰å·²é¸æ¢ä»¶
            const filters = {
                stage: document.getElementById('sel-stage').value,
                publisher: document.getElementById('sel-publisher').value,
                grade: document.getElementById('sel-grade').value,
                semester: document.getElementById('sel-semester').value
            };

            // æ ¹æ“šå±¤ç´šéæ¿¾å‡ºå”¯ä¸€å€¼
            const uniqueValues = new Set();
            fullData.forEach(item => {
                if (targetId === 'stage' || item.stage === filters.stage) {
                    if (targetId === 'publisher' || !filters.publisher || item.publisher === filters.publisher) {
                         if (targetId === 'grade' || !filters.grade || item.grade === filters.grade) {
                             if (targetId === 'semester' || !filters.semester || item.semester === filters.semester) {
                                 uniqueValues.add(item[targetId]);
                             }
                         }
                    }
                }
            });

            uniqueValues.forEach(val => {
                el.innerHTML += `<option value="${val}">${val}</option>`;
            });
        }

        // ç•¶é¸å–®è®Šæ›´æ™‚
        function filterData(level) {
            const levels = ['stage', 'publisher', 'grade', 'semester', 'unit'];
            const idx = levels.indexOf(level);
            
            // æ¸…ç©ºä¸¦é–å®šä¸‹å±¤é¸å–®
            for(let i = idx + 1; i < levels.length; i++) {
                const nextEl = document.getElementById(`sel-${levels[i]}`);
                nextEl.innerHTML = `<option value="" disabled selected>è«‹å…ˆé¸ä¸Šå±¤...</option>`;
                nextEl.disabled = true;
            }

            // é–‹å•Ÿä¸‹ä¸€å±¤
            if (idx < levels.length - 1) {
                const nextLevel = levels[idx + 1];
                
                // é‡å°ä¸‹ä¸€å±¤åšç‰¹å®šçš„è³‡æ–™ç¯©é¸
                // ç°¡åŒ–é‚è¼¯ï¼šç›´æ¥é‡è·‘ä¸€æ¬¡ç¯©é¸å‡½æ•¸å³å¯ï¼Œåªè¦ç¢ºä¿é †åºæ­£ç¢º
                // é€™è£¡æˆ‘å€‘ç›´æ¥æ‰¾å‡ºç¬¦åˆç•¶å‰æ‰€æœ‰æ¢ä»¶çš„è³‡æ–™ï¼Œå–å‡ºä¸‹ä¸€å±¤çš„å”¯ä¸€å€¼
                const currentFilters = {};
                for(let i=0; i<=idx; i++) currentFilters[levels[i]] = document.getElementById(`sel-${levels[i]}`).value;
                
                const nextEl = document.getElementById(`sel-${nextLevel}`);
                nextEl.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡...</option>';
                
                const uniqueNext = new Set();
                fullData.forEach(item => {
                    let match = true;
                    for(let k in currentFilters) if(item[k] != currentFilters[k]) match = false;
                    if(match) uniqueNext.add(item[nextLevel]);
                });
                
                uniqueNext.forEach(v => nextEl.innerHTML += `<option value="${v}">${v}</option>`);
                nextEl.disabled = false;
            }
        }

        // 3. AI åˆ†æèˆ‡ç”Ÿæˆ (å«è¢å…‰ç­†é‚è¼¯)
        async function fetchAndGenerate() {
            const unit = document.getElementById('sel-unit').value;
            if(!unit) return;

            // UI åˆ‡æ›
            document.getElementById('selection-panel').classList.add('hidden');
            document.getElementById('loading-view').classList.remove('hidden');
            document.getElementById('loading-view').classList.add('flex');
            document.getElementById('loading-unit-name').innerText = unit;

            // æº–å‚™åƒæ•¸
            const filters = {
                stage: document.getElementById('sel-stage').value,
                publisher: document.getElementById('sel-publisher').value,
                grade: document.getElementById('sel-grade').value,
                semester: document.getElementById('sel-semester').value,
                unit: unit
            };

            // --- å‘¼å« GAS å–å¾— Column I (èª²æ–‡) å’Œ Column S (è©å½™) ---
            // const res = await fetch(GAS_API_URL, { 
            //    method: 'POST', 
            //    body: JSON.stringify({ action: 'get_unit_content', filters: filters }) 
            // });
            // const result = await res.json();
            
            // --- æ¨¡æ“¬ GAS å›å‚³çš„å–®å…ƒè³‡æ–™ ---
            const mockContent = {
                raw_text: "æ¤ç‰©çš„æ ¹å¯ä»¥å¸æ”¶æ°´åˆ†å’Œé¤Šåˆ†ï¼Œä¸¦å›ºå®šæ¤ç‰©çš„èº«é«”ã€‚æ¤ç‰©çš„è–å¯ä»¥è¼¸é€æ°´åˆ†å’Œé¤Šåˆ†ï¼Œä¸¦æ”¯æ’æ¤ç‰©çš„èº«é«”ã€‚è‘‰å­æœƒè¡Œå…‰åˆä½œç”¨è£½é€ é¤Šåˆ†ã€‚",
                vocab_str: "æ ¹ã€è–ã€è‘‰ã€å…‰åˆä½œç”¨ã€å¸æ”¶ã€è¼¸é€"
            };
            // -----------------------------

            setTimeout(() => {
                renderContent(unit, filters, mockContent);
                document.getElementById('loading-view').classList.remove('flex');
                document.getElementById('loading-view').classList.add('hidden');
                document.getElementById('content-view').classList.remove('hidden');
                
                // æ¸²æŸ“ Mermaid (å¿…é ˆåœ¨å…ƒç´ é¡¯ç¤ºå¾Œ)
                document.getElementById('mermaid-chart').removeAttribute('data-processed');
                mermaid.init(undefined, document.getElementById('mermaid-chart'));
            }, 1500);
        }

        function renderContent(unitName, filters, data) {
            document.getElementById('result-title').innerText = unitName;
            document.getElementById('result-tag').innerText = `${filters.stage} â€¢ ${filters.grade}å¹´ç´š â€¢ ${filters.publisher}`;

            // A. è™•ç†è©å½™åˆ—è¡¨ (Side Panel)
            const vocabList = data.vocab_str.split(/[ã€,]/).map(v => v.trim()).filter(v => v);
            const vocabContainer = document.getElementById('keywords-list');
            vocabContainer.innerHTML = '';
            
            // ç‚ºäº†é¿å…é‡è¤‡å–ä»£ (ä¾‹å¦‚ã€Œå…‰åˆä½œç”¨ã€å’Œã€Œä½œç”¨ã€)ï¼Œæ‡‰å…ˆæ ¹æ“šé•·åº¦æ’åºè©å½™ (é•·è©å„ªå…ˆ)
            const sortedVocab = [...vocabList].sort((a, b) => b.length - a.length);

            // B. è™•ç†æ‘˜è¦èˆ‡è¢å…‰ç­† (Highlight Logic)
            let highlightedText = data.raw_text; // ä½¿ç”¨çœŸå¯¦èª²æ–‡ä½œç‚ºæ‘˜è¦åŸºç¤
            
            // åœ¨å´é‚Šæ¬„é¡¯ç¤º
            vocabList.forEach(v => {
                vocabContainer.innerHTML += `
                    <div class="bg-white p-2 px-3 rounded-lg border border-slate-100 shadow-sm flex items-center justify-between group hover:border-blue-300 transition cursor-help">
                        <span class="font-bold text-slate-700 group-hover:text-blue-600">${v}</span>
                        <i class="fa-solid fa-magnifying-glass text-slate-300 text-xs"></i>
                    </div>`;
            });

            // åœ¨æ–‡æœ¬ä¸­æ¨™ç¤º (Regex Replace)
            sortedVocab.forEach(v => {
                // ä½¿ç”¨ Regex å…¨åŸŸå–ä»£ï¼Œä¸¦åŠ å…¥ class="sci-vocab"
                const regex = new RegExp(v, 'g');
                // æ³¨æ„ï¼šé€™è£¡ç°¡å–®å¯¦ä½œï¼Œè‹¥è©å½™æœ‰åŒ…å«é—œä¿‚(å¦‚"æ°´"å’Œ"æ°´åˆ†")å¯èƒ½æœƒé‡è¤‡æ¨™è¨˜ï¼Œéœ€æ›´è¤‡é›œæ¼”ç®—æ³•ï¼Œæš«ç”¨é•·è©å„ªå…ˆè§£
                highlightedText = highlightedText.replace(regex, `<span class="sci-vocab">${v}</span>`);
            });

            // ç‚ºäº†è®“æ’ç‰ˆå¥½çœ‹ï¼Œå¯ä»¥ç°¡å–®åˆ†æ®µ
            document.getElementById('summary-text').innerHTML = highlightedText.split('ã€‚').join('ã€‚<br><br>');

            // C. Mermaid (ä»éœ€ AI ç”Ÿæˆï¼Œé€™è£¡ä½¿ç”¨ Mock çµæ§‹ï¼Œå¯¦éš›æ‡‰ç”± AI æ ¹æ“šèª²æ–‡ç”¢ç”Ÿ Mermaid Code)
            document.getElementById('mermaid-chart').innerHTML = `
                graph TD
                Root[${unitName}] --> Concept1(é‡è¦æ§‹é€ )
                Root --> Concept2(åŠŸèƒ½)
                Concept1 --> A[${vocabList[0] || 'æ§‹é€ A'}]
                Concept1 --> B[${vocabList[1] || 'æ§‹é€ B'}]
                Concept2 --> C[${vocabList[3] || 'åŠŸèƒ½C'}]
                A --> D(ç´°ç¯€èªªæ˜...)
                style Root fill:#dbeafe,stroke:#2563eb,stroke-width:2px
            `;

            // D. è¿·æ€ (Mock)
            document.getElementById('myth-list').innerHTML = `
                <div class="bg-white p-4 rounded-xl border-l-4 border-red-400 shadow-sm">
                    <div class="font-bold text-red-700 mb-1 text-sm"><i class="fa-solid fa-xmark"></i> å¸¸è¦‹è¿·æ€ 1</div>
                    <div class="text-xs text-slate-600">å­¸ç”Ÿå¸¸èª¤ä»¥ç‚º... (AI åˆ†æç”¢ç”Ÿ)</div>
                </div>
                 <div class="bg-white p-4 rounded-xl border-l-4 border-red-400 shadow-sm">
                    <div class="font-bold text-red-700 mb-1 text-sm"><i class="fa-solid fa-xmark"></i> å¸¸è¦‹è¿·æ€ 2</div>
                    <div class="text-xs text-slate-600">å¯¦éš›ä¸Šæ¦‚å¿µæ‡‰è©²æ˜¯...</div>
                </div>
            `;
        }

        // 4. å°ç§‘ AI èŠå¤©å®¤é–‹é—œ
        function toggleChat() {
            const win = document.getElementById('xiaoke-window');
            win.classList.toggle('closed');
        }
    </script>
</body>
</html>
