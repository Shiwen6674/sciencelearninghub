<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard | Science Learning Hub</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        student: { light: '#bfdbfe', DEFAULT: '#3b82f6', dark: '#1d4ed8' },
                        glass: {
                            100: 'rgba(255, 255, 255, 0.1)',
                            200: 'rgba(255, 255, 255, 0.2)',
                            700: 'rgba(255, 255, 255, 0.7)',
                            900: 'rgba(255, 255, 255, 0.9)',
                        }
                    },
                    fontFamily: {
                        serif: ['ui-serif', 'Georgia', 'Cambria', "Times New Roman", 'Times', 'serif'],
                        sans: ['ui-sans-serif', 'system-ui', '-apple-system', "Segoe UI", 'Roboto', "Helvetica Neue", 'Arial', 'sans-serif'],
                    },
                    animation: {
                        "spin-slow": "spin 10s linear infinite",
                        "gradient-x": "gradient-x 15s ease infinite",
                        "float": "float 6s ease-in-out infinite",
                    },
                    keyframes: {
                        "gradient-x": {
                            "0%, 100%": { "background-size": "200% 200%", "background-position": "left center" },
                            "50%": { "background-size": "200% 200%", "background-position": "right center" }
                        },
                        "float": {
                            "0%, 100%": { transform: "translateY(0)" },
                            "50%": { transform: "translateY(-10px)" }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden-section { display: none !important; }
        
        /* 玻璃擬態共用樣式 */
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.85);
            transform: translateY(-8px);
            box-shadow: 0 15px 50px -10px rgba(59, 130, 246, 0.4);
            border-color: rgba(59, 130, 246, 0.4);
        }

        .title-3d {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #7c3aed 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(2px 2px 0px rgba(59, 130, 246, 0.5)) 
                    drop-shadow(4px 4px 0px rgba(30, 58, 138, 0.3));
        }
        
        select, button, input { font-size: 1rem !important; }
        
        #canvas-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%; z-index: -10;
            overflow: hidden;
            background: linear-gradient(-45deg, #f8fafc, #eff6ff, #f3e8ff, #f0fdf4);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="min-h-screen font-sans flex flex-col text-slate-800 relative overflow-x-hidden selection:bg-blue-200">

    <!-- 背景動態層 -->
    <div id="canvas-container">
        <canvas id="network-canvas"></canvas>
    </div>

    <!-- 頂部導航列 (玻璃擬態) -->
    <nav class="glass-panel sticky top-0 z-50 border-b-0">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="backToDashboard()">
                <div class="bg-blue-100/80 p-2 rounded-xl text-blue-600 shadow-inner">
                    <i class="fa-solid fa-graduation-cap text-xl"></i>
                </div>
                <span class="text-xl font-bold tracking-tight text-slate-800 hidden md:block">Student Zone</span>
            </div>
            
            <div class="flex items-center space-x-4">
                <select id="language-selector" onchange="changeLanguage()" class="glass-card rounded-xl py-2 px-4 text-sm font-medium outline-none focus:ring-2 focus:ring-blue-400/50 cursor-pointer text-slate-700">
                    <option value="zh-TW">繁體中文</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                    <option value="zh-CN">简体中文</option>
                </select>
                
                <div class="flex items-center gap-3 pl-4 border-l border-slate-300/50">
                    <div class="flex items-center gap-2">
                        <div class="w-9 h-9 rounded-full bg-gradient-to-br from-blue-100 to-blue-50 text-blue-600 flex items-center justify-center text-sm font-bold border border-blue-200 shadow-sm" id="user-avatar">S</div>
                        <span class="text-sm font-bold text-slate-700 hidden md:block" id="user-name-display">Student</span>
                    </div>
                    <button onclick="logout()" class="text-slate-400 hover:text-rose-500 transition p-2 rounded-full hover:bg-rose-50" title="登出">
                        <i class="fa-solid fa-right-from-bracket text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主內容區 -->
    <main class="flex-1 overflow-y-auto p-6 md:p-10 relative z-10">
        <div class="max-w-7xl mx-auto">
            
            <!-- 1. 儀表板視圖 (Dashboard) -->
            <div id="dashboard-view" class="fade-in">
                <div class="text-center mb-20 mt-8">
                    <span class="text-blue-600 font-bold tracking-wider text-base uppercase mb-3 block opacity-80" data-i18n="role_student">學生專區</span>
                    <h1 class="title-3d text-5xl md:text-7xl font-black mb-6 tracking-tight leading-tight" data-i18n="welcome_student">歡迎來到科學學習中心</h1>
                    <p class="text-slate-500 text-xl md:text-2xl max-w-3xl mx-auto font-medium" data-i18n="select_tool">請選擇下方的學習工具開始您的科學探索之旅</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-10 px-4 mb-12">
                    <!-- 卡片 1: 科學文本 (★ 修正連結) -->
                    <div onclick="window.location.href='sciencebilingual.html'" class="glass-card p-10 rounded-[2.5rem] cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-blue-400/10 rounded-full blur-3xl group-hover:bg-blue-400/20 transition"></div>
                        
                        <div class="w-28 h-28 bg-gradient-to-br from-blue-50 to-white rounded-3xl flex items-center justify-center mb-8 shadow-lg shadow-blue-100 group-hover:scale-110 transition duration-300 border border-blue-100 group-hover:border-blue-200">
                            <i class="fa-solid fa-book-open-reader text-6xl text-blue-600"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-slate-800 mb-4 group-hover:text-blue-600 transition" data-i18n="feat_s_1_title">科學雙語文本</h3>
                        <p class="text-slate-500 text-base leading-relaxed" data-i18n="feat_s_1_desc">雙語對照閱讀，提升科學語言能力與專業詞彙量。</p>
                    </div>

                    <!-- 卡片 2: 重點整理 -->
                    <div onclick="window.location.href='unitkeyidea.html'" class="glass-card p-10 rounded-[2.5rem] cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                         <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-green-400/10 rounded-full blur-3xl group-hover:bg-green-400/20 transition"></div>
                        
                        <div class="w-28 h-28 bg-gradient-to-br from-green-50 to-white rounded-3xl flex items-center justify-center mb-8 shadow-lg shadow-green-100 group-hover:scale-110 transition duration-300 border border-green-100 group-hover:border-green-200">
                            <i class="fa-solid fa-highlighter text-6xl text-green-600"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-slate-800 mb-4 group-hover:text-green-600 transition" data-i18n="feat_s_2_title">單元重點整理</h3>
                        <p class="text-slate-500 text-base leading-relaxed" data-i18n="feat_s_2_desc">快速掌握各單元核心概念，圖文並茂的重點摘要。</p>
                    </div>

                    <!-- 卡片 3: AI 評量 -->
                    <div onclick="openTool('ai-grading')" class="glass-card p-10 rounded-[2.5rem] cursor-pointer group relative overflow-hidden flex flex-col items-center text-center">
                         <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-purple-400/10 rounded-full blur-3xl group-hover:bg-purple-400/20 transition"></div>
                        
                        <div class="w-28 h-28 bg-gradient-to-br from-purple-50 to-white rounded-3xl flex items-center justify-center mb-8 shadow-lg shadow-purple-100 group-hover:scale-110 transition duration-300 border border-purple-100 group-hover:border-purple-200">
                            <i class="fa-solid fa-wand-magic-sparkles text-6xl text-purple-600"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-slate-800 mb-4 group-hover:text-purple-600 transition" data-i18n="feat_s_3_title">AI自動命題與評量</h3>
                        <p class="text-slate-500 text-base leading-relaxed" data-i18n="feat_s_3_desc">客製化出題自我測驗，獲得即時且精準的學習回饋。</p>
                    </div>
                </div>
            </div>

            <!-- 功能視窗容器 (這裡保留其他功能的空殼，方便未來擴充) -->
            <div id="tool-container" class="hidden-section fade-in">
                <button onclick="backToDashboard()" class="mb-6 flex items-center gap-2 text-slate-500 hover:text-blue-600 transition font-bold bg-white/50 px-4 py-2 rounded-full w-fit backdrop-blur-sm hover:bg-white">
                    <i class="fa-solid fa-arrow-left"></i> <span data-i18n="back_dashboard">返回儀表板</span>
                </button>
                
                <!-- 工具佔位符 -->
                <div id="tool-unit-summary" class="tool-view hidden-section p-10 text-center text-slate-400">功能開發中...</div>
                <div id="tool-ai-grading" class="tool-view hidden-section p-10 text-center text-slate-400">功能開發中...</div>
            </div>
        </div>
    </main>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzcDKkz8Tilzb3qbx0_fDR7QoG4-c2JCtsa4p9V8_1gBjZaEMlvQHd72OD0kZq_jW8H/exec";

        const translations = {
            "zh-TW": {
                "role_student": "學生專區", "welcome_student": "歡迎來到科學學習中心", 
                "select_tool": "請選擇下方的學習工具開始您的科學探索之旅", 
                "back_dashboard": "返回儀表板",
                "feat_s_1_title": "科學雙語文本", "feat_s_1_desc": "雙語對照閱讀，提升科學語言能力與專業詞彙量。",
                "feat_s_2_title": "單元重點整理", "feat_s_2_desc": "快速掌握各單元核心概念，圖文並茂的重點摘要。",
                "feat_s_3_title": "AI自動命題與評量", "feat_s_3_desc": "客製化出題自我測驗，獲得即時且精準的學習回饋。",
                "logout": "登出"
            },
            "en": {
                "role_student": "Student Zone", "welcome_student": "Welcome to Science Learning Hub", 
                "select_tool": "Select a learning tool below to start your scientific exploration", 
                "back_dashboard": "Back to Dashboard",
                "feat_s_1_title": "Bilingual Science Text", "feat_s_1_desc": "Bilingual reading comparison to improve scientific language proficiency.",
                "feat_s_2_title": "Unit Summary", "feat_s_2_desc": "Quickly grasp core concepts with illustrated summaries.",
                "feat_s_3_title": "AI Assessment", "feat_s_3_desc": "Customized quizzes with instant and precise learning feedback.",
                "logout": "Logout"
            },
            "ja": {
                "role_student": "学生ゾーン", "welcome_student": "科学学習センターへようこそ", 
                "select_tool": "以下の学習ツールを選択して、科学の探求を始めましょう", 
                "back_dashboard": "ダッシュボードに戻る",
                "feat_s_1_title": "科学バイリンガルテキスト", "feat_s_1_desc": "二言語対訳で読み、科学語学力と専門用語を向上させます。",
                "feat_s_2_title": "単元のまとめ", "feat_s_2_desc": "図解付きの要約で、各単元の核心概念を素早く把握します。",
                "feat_s_3_title": "AI自動採点・評価", "feat_s_3_desc": "カスタマイズされたクイズで、即時かつ正確なフィードバックを得られます。",
                "logout": "ログアウト"
            },
            "zh-CN": {
                "role_student": "学生专区", "welcome_student": "欢迎来到科学学习中心", 
                "select_tool": "请选择下方的学习工具开始您的科学探索之旅", 
                "back_dashboard": "返回仪表板",
                "feat_s_1_title": "科学双语文本", "feat_s_1_desc": "双语对照阅读，提升科学语言能力与专业词汇量。",
                "feat_s_2_title": "单元重点整理", "feat_s_2_desc": "快速掌握各单元核心概念，图文并茂的重点摘要。",
                "feat_s_3_title": "AI自动命题与评量", "feat_s_3_desc": "客制化出题自我测验，获得即时且精准的学习回馈。",
                "logout": "登出"
            }
        };

        // 1. 權限檢查與用戶資料
        const userJson = sessionStorage.getItem("currentUser");
        const currentUser = userJson ? JSON.parse(userJson) : { name: "訪客", role: "Student" };
        
        document.getElementById("user-name-display").innerText = currentUser.name;
        document.getElementById("user-avatar").innerText = currentUser.name.charAt(0).toUpperCase();

        // 2. 語言邏輯
        function initLanguage() {
            const savedLang = localStorage.getItem("slh_lang");
            if (savedLang) {
                document.getElementById("language-selector").value = savedLang;
                changeLanguage();
            }
        }

        function changeLanguage() {
            const lang = document.getElementById("language-selector").value;
            localStorage.setItem("slh_lang", lang);
            const elements = document.querySelectorAll("[data-i18n]");
            elements.forEach(el => {
                const key = el.getAttribute("data-i18n");
                if (translations[lang] && translations[lang][key]) {
                    el.innerText = translations[lang][key];
                }
            });
        }

        window.addEventListener('DOMContentLoaded', initLanguage);

        // 3. 頁面切換邏輯 (針對未獨立的工具)
        function openTool(toolId) {
            document.getElementById("dashboard-view").classList.add("hidden-section");
            document.getElementById("tool-container").classList.remove("hidden-section");
            
            document.querySelectorAll(".tool-view").forEach(el => el.classList.add("hidden-section"));
            const target = document.getElementById("tool-" + toolId);
            if(target) target.classList.remove("hidden-section");
            
            logAction(toolId);
        }

        function backToDashboard() {
            document.getElementById("tool-container").classList.add("hidden-section");
            document.getElementById("dashboard-view").classList.remove("hidden-section");
        }

        function logAction(actionName) {
            const payload = {
                type: "log",
                name: currentUser.name,
                role: currentUser.role,
                action: "use_tool",
                page: actionName
            };
            fetch(GAS_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) }).catch(e => console.log("Log ignored"));
        }

        function logout() {
            if(confirm("確定要登出嗎？")) {
                sessionStorage.removeItem("currentUser");
                window.location.href = "index.html";
            }
        }

        // Canvas Background
        (function() {
            const canvas = document.getElementById('network-canvas');
            const ctx = canvas.getContext('2d');
            let width, height, orbits = [], centerX, centerY, targetCenterX, targetCenterY, mouse = { x: null, y: null };
            window.addEventListener('mousemove', function(e) { mouse.x = e.x; mouse.y = e.y; });
            function resize() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; centerX = width / 2; centerY = height / 2; targetCenterX = centerX; targetCenterY = centerY; initOrbits(); }
            class Orbit { constructor(rx, ry, a, c, s, pc) { this.rx=rx; this.ry=ry; this.a=a; this.s=s; this.c=c; this.pc=pc; this.r=0; this.ea=Math.random()*Math.PI*2; } update(){ this.r+=this.s; this.ea+=0.002; } draw(){ ctx.save(); ctx.translate(centerX,centerY); ctx.rotate(this.a); ctx.beginPath(); ctx.ellipse(0,0,this.rx,this.ry,this.r,0,Math.PI*2); ctx.strokeStyle=this.c; ctx.lineWidth=1; ctx.stroke(); ctx.beginPath(); ctx.arc(this.rx*Math.cos(this.ea), this.ry*Math.sin(this.ea), 3, 0, Math.PI*2); ctx.fillStyle=this.pc; ctx.fill(); ctx.restore(); } }
            function initOrbits() { orbits=[]; const br=width<height?width*0.2:height*0.25; orbits.push(new Orbit(br*2.2, br*2.2, 0, 'rgba(59,130,246,0.1)', 0.0005, 'rgba(147,197,253,0.6)')); orbits.push(new Orbit(br*1.3, br*0.5, Math.PI/6, 'rgba(59,130,246,0.1)', 0.001, 'rgba(147,197,253,0.6)')); }
            function animate() { ctx.clearRect(0,0,width,height); if(mouse.x){ targetCenterX=width/2+(mouse.x-width/2)*0.03; targetCenterY=height/2+(mouse.y-height/2)*0.03; } centerX+=(targetCenterX-centerX)*0.05; centerY+=(targetCenterY-centerY)*0.05; orbits.forEach(o=>{o.update();o.draw()}); ctx.beginPath(); ctx.arc(centerX,centerY,5,0,Math.PI*2); ctx.fillStyle='rgba(59,130,246,0.2)'; ctx.fill(); requestAnimationFrame(animate); }
            window.addEventListener('resize', resize); resize(); animate();
        })();
    </script>
</body>
</html>
