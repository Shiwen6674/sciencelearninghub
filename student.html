<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard | Science Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        student: { light: '#bfdbfe', DEFAULT: '#3b82f6', dark: '#1d4ed8' },
                    },
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-slate-50 h-screen flex flex-col font-sans text-slate-800 overflow-hidden">

    <!-- 頂部導航列 -->
    <nav class="bg-white shadow-sm border-b border-slate-200 p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="bg-blue-100 p-2 rounded-lg text-blue-600"><i class="fa-solid fa-graduation-cap text-xl"></i></div>
                <span class="text-lg font-bold tracking-tight text-slate-800">Student Zone</span>
            </div>
            <div class="flex items-center space-x-4">
                <select id="language-selector" onchange="changeLanguage()" class="border-slate-300 rounded-lg py-1.5 px-3 text-sm bg-slate-50 outline-none focus:ring-2 focus:ring-blue-500 transition cursor-pointer hover:bg-white">
                    <option value="zh-TW">繁體中文</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                    <option value="zh-CN">简体中文</option>
                </select>
                <div class="flex items-center gap-3 pl-4 border-l border-slate-200">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-sm font-bold border border-blue-200" id="user-avatar">S</div>
                        <span class="text-sm font-medium text-slate-600 hidden md:block" id="user-name-display">Student</span>
                    </div>
                    <button onclick="logout()" class="text-slate-400 hover:text-rose-500 transition p-2" title="登出"><i class="fa-solid fa-right-from-bracket"></i></button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主內容區 -->
    <main class="flex-1 overflow-y-auto p-6 md:p-10">
        <div class="max-w-7xl mx-auto">
            
            <!-- 儀表板視圖 (方塊選單) -->
            <div id="dashboard-view" class="fade-in">
                <div class="text-center mb-12">
                    <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-3" data-i18n="welcome_student">歡迎來到學生學習專區</h1>
                    <p class="text-slate-500 text-lg" data-i18n="select_tool">請選擇您要進行的學習活動</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- 卡片 1 -->
                    <div onclick="openTool('science-text')" class="bg-white p-8 rounded-3xl shadow-lg shadow-blue-100/50 hover:shadow-xl hover:shadow-blue-200 border border-slate-100 cursor-pointer transition transform hover:-translate-y-1 group">
                        <div class="w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-100 transition">
                            <i class="fa-solid fa-language text-3xl text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 mb-2 group-hover:text-blue-600 transition" data-i18n="feat_s_1">科學雙語文本</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">中英對照閱讀，提升科學英語能力</p>
                    </div>

                    <!-- 卡片 2 -->
                    <div onclick="openTool('unit-summary')" class="bg-white p-8 rounded-3xl shadow-lg shadow-blue-100/50 hover:shadow-xl hover:shadow-blue-200 border border-slate-100 cursor-pointer transition transform hover:-translate-y-1 group">
                        <div class="w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-100 transition">
                            <i class="fa-solid fa-list-check text-3xl text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 mb-2 group-hover:text-blue-600 transition" data-i18n="feat_s_2">單元重點整理</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">快速掌握各單元核心概念與重點</p>
                    </div>

                    <!-- 卡片 3 -->
                    <div onclick="openTool('ai-grading')" class="bg-white p-8 rounded-3xl shadow-lg shadow-blue-100/50 hover:shadow-xl hover:shadow-blue-200 border border-slate-100 cursor-pointer transition transform hover:-translate-y-1 group">
                        <div class="w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-100 transition">
                            <i class="fa-solid fa-robot text-3xl text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 mb-2 group-hover:text-blue-600 transition" data-i18n="feat_s_3">AI自動命題與評量</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">自我測驗與即時回饋，強化學習成效</p>
                    </div>
                </div>
            </div>

            <!-- 功能視窗容器 (預設隱藏) -->
            <div id="tool-container" class="hidden fade-in">
                <button onclick="backToDashboard()" class="mb-6 flex items-center gap-2 text-slate-500 hover:text-blue-600 transition font-medium">
                    <i class="fa-solid fa-arrow-left"></i> <span data-i18n="back_dashboard">返回儀表板</span>
                </button>

                <!-- 1. 科學雙語文本 -->
                <div id="tool-science-text" class="tool-view hidden bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                    <h2 class="text-2xl font-bold text-blue-800 mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-language"></i> <span data-i18n="feat_s_1">科學雙語文本</span>
                    </h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="p-6 bg-slate-50 rounded-2xl border border-slate-200">
                            <h3 class="font-bold text-slate-700 mb-4 border-b pb-2">中文閱讀</h3>
                            <div class="h-80 overflow-y-auto text-slate-600 leading-relaxed text-justify pr-2">
                                (這裡將顯示中文科學文章內容...) <br><br> 光合作用是植物、藻類和某些細菌利用光能將二氧化碳和水轉化為葡萄糖和氧氣的過程。這個過程對於地球上的生命至關重要，因為它提供了食物鏈的基礎能量來源，並釋放出我們呼吸所需的氧氣。
                            </div>
                        </div>
                        <div class="p-6 bg-slate-50 rounded-2xl border border-slate-200">
                            <h3 class="font-bold text-slate-700 mb-4 border-b pb-2">English Reading</h3>
                            <div class="h-80 overflow-y-auto text-slate-600 leading-relaxed text-justify pr-2">
                                (Content will be displayed here...) <br><br> Photosynthesis is the process by which plants, algae, and certain bacteria use light energy to convert carbon dioxide and water into glucose and oxygen. This process is vital for life on Earth as it provides the base energy source for the food chain and releases the oxygen we breathe.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. 單元重點整理 -->
                <div id="tool-unit-summary" class="tool-view hidden bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                    <h2 class="text-2xl font-bold text-blue-800 mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-list-check"></i> <span data-i18n="feat_s_2">單元重點整理</span>
                    </h2>
                    <div class="flex gap-4 mb-8">
                        <select class="border-slate-300 p-2.5 rounded-lg w-full max-w-xs focus:ring-2 focus:ring-blue-500 outline-none">
                            <option>選擇單元...</option>
                            <option>光與影</option>
                            <option>力與運動</option>
                            <option>植物的構造</option>
                        </select>
                        <button class="bg-blue-600 text-white px-6 py-2.5 rounded-lg hover:bg-blue-700 transition shadow-md">產生摘要</button>
                    </div>
                    <div class="space-y-4">
                        <div class="p-5 border-l-4 border-blue-500 bg-blue-50 rounded-r-xl">
                            <h4 class="font-bold text-blue-800 text-lg">核心概念 1</h4>
                            <p class="text-slate-600 mt-2">光是直線前進的，當遇到不透明物體時會形成影子。</p>
                        </div>
                        <div class="p-5 border-l-4 border-blue-500 bg-blue-50 rounded-r-xl">
                            <h4 class="font-bold text-blue-800 text-lg">核心概念 2</h4>
                            <p class="text-slate-600 mt-2">反射定律：入射角等於反射角。這是面鏡成像的基礎。</p>
                        </div>
                    </div>
                </div>

                <!-- 3. AI自動命題與評量 -->
                <div id="tool-ai-grading" class="tool-view hidden bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                    <h2 class="text-2xl font-bold text-blue-800 mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-robot"></i> <span data-i18n="feat_s_3">AI自動命題與評量</span>
                    </h2>
                    <div class="space-y-8">
                        <div class="p-6 bg-slate-50 rounded-2xl border border-slate-200">
                            <p class="font-bold text-lg mb-4 text-slate-800">1. 下列關於光合作用的敘述，何者正確？</p>
                            <div class="space-y-3 text-slate-700">
                                <label class="flex items-center gap-3 cursor-pointer p-2 hover:bg-white rounded-lg transition"><input type="radio" name="q1" class="w-5 h-5 text-blue-600 focus:ring-blue-500"> <span>A. 主要在根部進行</span></label>
                                <label class="flex items-center gap-3 cursor-pointer p-2 hover:bg-white rounded-lg transition"><input type="radio" name="q1" class="w-5 h-5 text-blue-600 focus:ring-blue-500"> <span>B. 需要氧氣參與反應</span></label>
                                <label class="flex items-center gap-3 cursor-pointer p-2 hover:bg-white rounded-lg transition"><input type="radio" name="q1" class="w-5 h-5 text-blue-600 focus:ring-blue-500"> <span>C. 產物包含葡萄糖與氧氣</span></label>
                                <label class="flex items-center gap-3 cursor-pointer p-2 hover:bg-white rounded-lg transition"><input type="radio" name="q1" class="w-5 h-5 text-blue-600 focus:ring-blue-500"> <span>D. 只能在晚上進行</span></label>
                            </div>
                        </div>
                        <button class="w-full md:w-auto bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 shadow-lg transition transform active:scale-95">提交答案並取得回饋</button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzcDKkz8Tilzb3qbx0_fDR7QoG4-c2JCtsa4p9V8_1gBjZaEMlvQHd72OD0kZq_jW8H/exec";

        // 語言字典 (與首頁保持一致)
        const translations = {
            "zh-TW": {
                "welcome_student": "歡迎來到學生學習專區", "select_tool": "請選擇您要進行的學習活動", "back_dashboard": "返回儀表板",
                "feat_s_1": "科學雙語文本", "feat_s_2": "單元重點整理", "feat_s_3": "AI自動命題與評量",
                "logout": "登出"
            },
            "en": {
                "welcome_student": "Welcome to Student Zone", "select_tool": "Select a learning activity", "back_dashboard": "Back to Dashboard",
                "feat_s_1": "Bilingual Science Text", "feat_s_2": "Unit Summary", "feat_s_3": "AI Assessment",
                "logout": "Logout"
            },
            "ja": {
                "welcome_student": "学生学習ゾーンへようこそ", "select_tool": "学習活動を選択してください", "back_dashboard": "ダッシュボードに戻る",
                "feat_s_1": "科学バイリンガルテキスト", "feat_s_2": "単元のまとめ", "feat_s_3": "AI採点とフィードバック",
                "logout": "ログアウト"
            },
            "zh-CN": {
                "welcome_student": "欢迎来到学生学习专区", "select_tool": "请选择您要进行的学习活动", "back_dashboard": "返回仪表板",
                "feat_s_1": "科学双语文本", "feat_s_2": "单元重点整理", "feat_s_3": "AI自动命题与评分",
                "logout": "登出"
            }
        };

        // --- 1. 權限檢查 ---
        const userJson = sessionStorage.getItem("currentUser");
        if (!userJson) {
            alert("請先登入！");
            window.location.href = "index.html";
        }
        const currentUser = JSON.parse(userJson);
        
        document.getElementById("user-name-display").innerText = currentUser.name;
        document.getElementById("user-avatar").innerText = currentUser.name.charAt(0).toUpperCase();

        // --- 2. 語言邏輯 (自動讀取) ---
        function initLanguage() {
            const savedLang = localStorage.getItem("slh_lang");
            if (savedLang) {
                document.getElementById("language-selector").value = savedLang;
                changeLanguage();
            }
        }

        function changeLanguage() {
            const lang = document.getElementById("language-selector").value;
            localStorage.setItem("slh_lang", lang);
            const elements = document.querySelectorAll("[data-i18n]");
            elements.forEach(el => {
                const key = el.getAttribute("data-i18n");
                if (translations[lang] && translations[lang][key]) {
                    el.innerText = translations[lang][key];
                }
            });
        }

        window.addEventListener('DOMContentLoaded', initLanguage);

        // --- 3. 頁面切換邏輯 ---
        function openTool(toolId) {
            document.getElementById("dashboard-view").classList.add("hidden");
            document.getElementById("tool-container").classList.remove("hidden");
            
            document.querySelectorAll(".tool-view").forEach(el => el.classList.add("hidden"));
            document.getElementById("tool-" + toolId).classList.remove("hidden");
            
            logAction(toolId);
        }

        function backToDashboard() {
            document.getElementById("tool-container").classList.add("hidden");
            document.getElementById("dashboard-view").classList.remove("hidden");
        }

        function logAction(actionName) {
            const payload = {
                type: "log",
                name: currentUser.name,
                role: currentUser.role,
                action: "use_tool",
                page: actionName
            };
            fetch(GAS_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
        }

        function logout() {
            if(confirm("確定要登出嗎？")) {
                sessionStorage.removeItem("currentUser");
                window.location.href = "index.html";
            }
        }
    </script>
</body>
</html>
